<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Panty & Stocking åŒäººè§’è‰²å¡ä»‹ç»é¡µé¢">
    <meta name="theme-color" content="#ffea7f">
    <title>Panty & Stocking - è§’è‰²å¡ä»‹ç»</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ==================== åŸºç¡€å…¨å±€æ ·å¼ ==================== */
        :root {
            --color-panty: #ffea7f;
            --color-stocking: #c39dff;
            --color-pink: #ff87ab;
            --color-cyan: #00e5ff;
            --color-text: #333;
            --color-text-light: #555;
            --color-heading: #222;
            --color-border: rgba(255, 255, 255, 0.4);
            --bg-card: rgba(255, 255, 255, 0.85);
            --bg-group: rgba(255, 255, 255, 0.7);
            --radius-lg: 20px;
            --radius-md: 12px;
            --radius-sm: 10px;
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Poppins', 'Noto Sans SC', sans-serif;
            color: var(--color-text);
            line-height: 1.8;
            padding: 2rem 1.25rem;
            min-height: 100vh;
            background: linear-gradient(160deg, #ffea7f 0%, #ff87ab 45%, #c39dff 100%);
            background-attachment: fixed;
            padding-bottom: 150px;
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            width: 100%; max-width: 900px; margin: 0 auto;
            background: var(--bg-card);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: clamp(2rem, 8vw, 3.5rem);
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* æ ‡é¢˜ä¸æ–‡æœ¬ */
        .header { text-align: center; margin-bottom: 2rem; }
        .title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(3rem, 12vw, 9rem);
            line-height: 1; font-weight: 900; margin-bottom: 0.3em;
        }
        .title-panty { background: linear-gradient(120deg, #ffea7f, #ff87ab); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .title-stocking { background: linear-gradient(120deg, #c39dff, #ff87ab); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 0.95rem; color: var(--color-text-light); font-weight: 500; opacity: 0.9; }
        .golden-divider {
            height: 0.5px; margin: 0.6em auto 1.2em; width: 95%; max-width: 550px;
            background: linear-gradient(to right, transparent 0%, #ffd700 50%, transparent 100%);
        }

        h1, h2, h3 { color: var(--color-heading); font-weight: 700; margin-bottom: 0.5em; }
        .content-section {
            background: var(--bg-group); border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: var(--radius-md); padding: 1.75rem; margin-bottom: 2rem; transition: 0.3s;
        }
        .content-section:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.1); transform: translateY(-2px); }

        /* æŒ‰é’®ç»„ */
        .button-group { 
            display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; justify-content: center; 
        }
        .btn {
            flex: 1; min-width: 160px; display: inline-flex; align-items: center; justify-content: center;
            gap: 0.6em; padding: 1em 1.5em; font-weight: 700; color: white;
            border: none; border-radius: var(--radius-sm); cursor: pointer; transition: 0.2s;
            text-decoration: none; position: relative; overflow: hidden; font-size: 1rem;
            box-sizing: border-box; height: 56px;
        }
        .btn-primary { background: linear-gradient(120deg, var(--color-pink), var(--color-cyan)); }
        .btn-secondary { background: linear-gradient(120deg, var(--color-panty), var(--color-pink)); }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn:active { transform: translateY(-1px); }
        .btn-icon { width: 1.4em; height: 1.4em; }

        /* æŠ˜å é¢æ¿ */
        .accordion { border: 1px solid var(--color-border); border-radius: var(--radius-md); margin-bottom: 1rem; overflow: hidden; }
        .accordion-trigger {
            width: 100%; padding: 1.3em; font-size: 1.2rem; font-weight: 700; color: white;
            background: linear-gradient(90deg, rgba(255, 135, 171, 0.85), rgba(0, 229, 255, 0.85));
            border: none; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .accordion-content { padding: 2em; background: rgba(255, 255, 255, 0.5); animation: expandDown 0.3s ease-out; }
        @keyframes expandDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 1000px; } }

        /* é¸£è°¢å¡ç‰‡ */
        .credits-card {
            padding: 3px; margin: 4rem auto 0; border-radius: var(--radius-lg);
            background: linear-gradient(120deg, var(--color-panty), var(--color-pink), var(--color-stocking));
        }
        .credits-content { background: var(--bg-card); padding: 2.5em; border-radius: calc(var(--radius-lg) - 3px); text-align: center; }
        .credit-item {
            font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5em; cursor: pointer; display: inline-block; width: 100%;
            background: linear-gradient(120deg, #9370db, var(--color-stocking)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            transition: transform 0.2s; user-select: none;
        }
        .credit-item:hover { transform: scale(1.1); }

        /* åŠ¨ç”»å…ƒç´  */
        .floating-heart {
            position: fixed; font-size: 1.5rem; pointer-events: none; z-index: 9999;
            animation: heartRise 1s ease-out forwards;
        }
        @keyframes heartRise { 0% { opacity: 1; } 100% { opacity: 0; transform: translateY(-80px) scale(1.5); } }
        
        .floating-bubble {
            position: fixed; background: linear-gradient(135deg, #FFE5F0 0%, #FFF0F7 100%);
            border: 2px solid #ffb6d9; border-radius: 30px;
            padding: 0.8em 1.5em; font-size: 0.9rem; font-weight: 700; color: #d63384;
            box-shadow: 0 8px 30px rgba(255, 135, 171, 0.3); pointer-events: none; z-index: 9998;
            animation: bubbleFloat 2s cubic-bezier(0.25, 1, 0.5, 1) forwards; white-space: pre-line; text-align: center;
        }
        @keyframes bubbleFloat { 0% { opacity: 0; transform: scale(0.3) translateY(0); } 10% { opacity: 1; transform: scale(1) translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }
        
        .toast {
            position: fixed; bottom: 20px; right: 20px; padding: 10px 20px;
            background: rgba(125, 255, 193, 0.95); color: #333; font-weight: bold; border-radius: 10px;
            z-index: 10000; animation: fadeUp 0.3s ease-out; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        @keyframes fadeUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform:translateY(0); } }

        /* ==================== ğŸµ æ‚¬æµ®æ’­æ”¾å™¨ V3 ==================== */
        .music-widget {
            position: fixed; z-index: 9000;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: width 0.4s, height 0.4s, border-radius 0.4s;
            overflow: hidden;
            bottom: 30px; left: 30px;
            touch-action: none; cursor: move;
        }
        @media (max-width: 768px) { .music-widget { bottom: auto; top: 20px; } }

        .music-widget.expanded { width: 340px; min-height: 110px; border-radius: 20px; display: flex; flex-direction: column; }
        .music-widget.collapsed { width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .music-widget.collapsed:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--color-pink); }

        .player-header { display: flex; align-items: center; padding: 15px; width: 100%; position: relative; }
        .music-disc {
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, var(--color-panty), var(--color-pink));
            border: 3px solid rgba(255,255,255,0.8);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            flex-shrink: 0; transition: 0.5s; pointer-events: none;
        }
        .music-widget.collapsed .music-disc { background: transparent; border: none; box-shadow: none; }
        .music-widget.collapsed::after { content: ''; position: absolute; width: 100%; height: 100%; border-radius: 50%; background: rgba(255,255,255,0.4); z-index: -1; }
        
        .rotate { animation: spin 6s linear infinite; }
        .paused { animation-play-state: paused; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .player-content { flex: 1; margin-left: 15px; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
        .music-widget.collapsed .player-content { display: none; }
        .song-title { font-size: 0.9rem; font-weight: 700; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 8px; }

        .controls-row { display: flex; align-items: center; gap: 10px; }
        .ctrl-btn {
            background: none; border: none; cursor: pointer; color: #666; font-size: 1.1rem;
            width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .ctrl-btn:hover { background: rgba(255,255,255,0.5); color: var(--color-pink); }

        .playlist-panel { width: 100%; max-height: 0; overflow-y: auto; background: rgba(255,255,255,0.5); transition: 0.3s; border-top: 1px solid rgba(255,255,255,0.3); }
        .playlist-panel.show { max-height: 200px; }
        .playlist-item { padding: 10px 15px; border-bottom: 1px solid rgba(255,255,255,0.2); font-size: 0.85rem; color: #555; cursor: pointer; }
        .playlist-item.current { color: #d63384; font-weight: 600; background: rgba(255,135,171,0.1); }

        .minimize-btn { position: absolute; top: 5px; right: 8px; font-size: 1.2rem; color: #888; background: none; border: none; z-index: 10; }
        .music-widget.collapsed .minimize-btn { display: none; }
        
        .url-code-block { display: none; } 
    </style>
</head>
<body>
    <main class="main-container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <header class="header">
            <h1 class="title">
                <span class="title-panty">Panty</span>
                <span class="title-stocking">Stocking</span>
            </h1>
            <div class="golden-divider"></div>
            <p class="subtitle">ğŸ¬ åŒäººè§’è‰²å¡</p>
            <p class="subtitle">ã€ŠPanty and Stocking with Garterbeltã€‹</p>
        </header>

        <!-- ç®€ä»‹åŒº -->
        <section class="content-section">
            <h2>ğŸ‘‹ æ¬¢è¿æ¥åˆ°å •å¤©åŸ</h2>
            <h4>è¿™æ˜¯ä¸€ä¸ªå……æ»¡åˆ›æ„çš„åŒäººè§’è‰²å¡é¡¹ç›®</h4>
            <p>æœ¬å¡ä¸¥æ ¼éµå¾ªåŠ¨æ¼«ä¸–ç•Œè§‚è®¾å®šï¼Œèåˆå¤šä¸ªè§’è‰²çš„æ·±åº¦äººè®¾ï¼Œæ— éœ€è§‚çœ‹åŸä½œä¹Ÿèƒ½äº«å—ç²¾å½©ä½“éªŒã€‚åŒ…å« <strong>9ä½ä¸»è§’</strong> ä¸ <strong>6ä½é…è§’</strong>ï¼Œä»¥åŠ <strong>4ä¸ªè‡ªå®šä¹‰ç”¨æˆ·äººè®¾</strong>ã€‚</p>
        </section>

        <!-- ç‰¹è‰²ä»‹ç» -->
        <section class="content-section">
            <h3>âœ¨ é¡¹ç›®ç‰¹è‰²</h3>
            <ul>
                <li>ä¸¥è°¨çš„ä¸–ç•Œè§‚è®¾å®šä¸äººç‰©äººè®¾ï¼Œå‚è€ƒåŠ¨æ¼«ä¸å®˜æ–¹ Wiki</li>
                <li>9ä½ä¸»è§’ä¸6ä½é…è§’ï¼Œä¸°å¯Œçš„è§’è‰²äº’åŠ¨ä½“éªŒ</li>
                <li>4ä¸ªè‡ªå®šä¹‰ç”¨æˆ·äººè®¾ï¼Œé€‚åº”ä¸åŒç©å®¶åå¥½</li>
                <li>å³ä½¿æœªçœ‹åŸä½œä¹Ÿèƒ½ä¸Šæ‰‹æ¸¸ç©ï¼Œæ— é—¨æ§›ä½“éªŒ</li>
                <li>æŒç»­æ›´æ–°ä¸­ï¼Œä¸–ç•Œè§‚å°†ä¸æ–­å®Œå–„</li>
            </ul>
        </section>

        <!-- é“¾æ¥ä¸åˆ†äº« -->
        <section class="content-section">
            <h3>ğŸ”— è·å–è§’è‰²å¡</h3>
            <p>ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è®¿é—®å‘å¸ƒå¸–å­ï¼Œæˆ–ç›´æ¥å¤åˆ¶é“¾æ¥åˆ†äº«ç»™æœ‹å‹ã€‚</p>
            
            <div class="button-group">
                <button class="btn btn-primary" id="mainCopyBtn">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                    <span>å¤åˆ¶é“¾æ¥</span>
                </button>
                <a href="https://discord.com/channels/1134557553011998840/1434325852165902366" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/></svg>
                    <span>å‰å¾€å¸–å­</span>
                </a>
            </div>
        </section>

        <!-- åŠŸèƒ½ä»‹ç»åŒºåŸŸ -->
        <div style="text-align: center; margin: 3rem 0;">
            <h2 style="color: var(--color-pink); border: 2px solid var(--color-pink); border-radius: 12px; display: inline-block; padding: 0.5em 1em;">ğŸ“š åŠŸèƒ½ä»‹ç»</h2>
        </div>

        <!-- å¼€åœºå‰§æƒ… -->
        <details class="accordion">
            <summary class="accordion-trigger"><span>ğŸ¬ å¼€åœºå‰§æƒ…</span></summary>
            <div class="accordion-content">
                <h3>å…±åŒ…å« 8 ä¸ªä¸»çº¿å‰§æƒ… + 1 ä¸ªå¼€æ”¾å¼å¼€åœº</h3>
                <ul>
                    <li><strong>å‰§æƒ…ä¸€ï¼š</strong> ä¸€å¦‚å¾€å¸¸ï¼Œå¤©ä½¿å§å¦¹ä¸¤äººåˆè¢«å–Šå»å¤„ç†ä»»åŠ¡ã€‚</li>
                    <li><strong>å‰§æƒ…äºŒï¼š</strong> å¤©ä½¿å§å¦¹åˆåœ¨å •å¤©åŸé«˜ä¸­é—¹ç–¯äº†ï¼Œæ¶é­”å§å¦¹å‡ºé¢ä¸å¤©ä½¿å§å¦¹å¯¹å³™ã€‚</li>
                    <li><strong>å‰§æƒ…ä¸‰ï¼š</strong> å¤©ä½¿å…„å¼Ÿæ¥ä¹‹ä¸æ˜“çš„åº¦å‡æ—¶é—´ï¼Œæ¥åˆ°äº†äººé—´å •å¤©æµ·æ»©åº¦å‡ã€‚</li>
                    <li><strong>å‰§æƒ…å››ï¼š</strong> æªæ¢°åŒ å©Šåœ¨å­¦æ ¡é—¨å£è·Ÿå¸ƒåˆ©å¤«é“åˆ«åˆ†å¼€åï¼Œæ¥åˆ°äº†ä¸€å¤„å°å··åšèµ·äº†ä»€ä¹ˆç§˜å¯†äº¤æ˜“ã€‚</li>
                    <li><strong>å‰§æƒ…äº”ï¼š</strong> ä»Šå¤©çš„ç¥çˆ¶æ„Ÿè§‰å¿ƒæƒ…ç‰¹åˆ«å¥½ï¼ŒåŸæ¥æ˜¯ä»Šå¤©ä»–è¯·æ±‚åˆ°äº†ç¥è°•ï¼Œè¯´ä»–ä»Šå¤©çš„è¿æ°”ä¼šç‰¹åˆ«å¥½ã€‚</li>
                    <li><strong>å‰§æƒ…å…­ï¼š</strong> ä¸æ¡ƒé‡‘åœ¨æ‰‹æœºçœ‹åˆ°äº†é™å®šæ¬¾æ…•æ–¯è›‹ç³•ï¼Œå‰å¾€äº†é‚£å®¶åä¸ºä¸‹åˆèŒ¶çš„ç”œå“åº—ã€‚</li>
                    <li><strong>å‰§æƒ…ä¸ƒï¼š</strong> å¸ƒåˆ©å¤«è·Ÿæªæ¢°åŒ å©Šä¸€èµ·æ”¾å­¦å‰å¾€äº†å•†åœºï¼Œè®¨è®ºç€ä»Šå¤©æ–°å‡ºçš„é‚£æ¬¾æ¸¸æˆæœºã€‚</li>
                    <li><strong>å‰§æƒ…å…«ï¼š</strong> å •å¤©åŸå‘ç”Ÿäº†å‰æ‰€æœªæœ‰çš„å±æœºï¼Œæ•´æ•´ä¸¤åª S çº§æ¶çµç°èº«ï¼Œå…¨å‘˜å‡ºåŠ¨ï¼</li>
                </ul>
            </div>
        </details>

        <!-- ä¸»è§’äººè®¾ -->
        <details class="accordion">
            <summary class="accordion-trigger"><span>ğŸ‘¥ ä¸»è§’äººè®¾</span></summary>
            <div class="accordion-content">
                <h3>æä¾› 4 ä¸ªè‡ªå®šä¹‰ç”¨æˆ·äººè®¾</h3>
                <p>æ¯ä¸ªäººè®¾éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œ<em>äººè®¾å¡é»˜è®¤å…³é—­ï¼Œè¯·åœ¨ä¸–ç•Œä¹¦æœ€åä¸€é¡µè‡ªè¡Œå¯ç”¨</em>ã€‚</p>
                <ul>
                    <li><strong>Meruï¼š</strong> è·Ÿ Stocking æ€§æ ¼ç›¸ä¼¼çš„å¯çˆ±ç”·å­©å­ï¼Œæ‹¥æœ‰å¼ºå¤§çš„æ­¦å™¨ä¸èƒ½åŠ›ã€‚</li>
                    <li><strong>Draculaï¼š</strong> å¾·å¤æ‹‰å¸è¡€é¬¼äººè®¾ï¼Œå…·æœ‰å¼ºå¤§çš„è¶…è‡ªç„¶åŠ›é‡ã€‚</li>
                    <li><strong>Leoï¼š</strong> ä¸“å±äººè®¾ï¼Œè‚Œè‚‰çŒ›ç”·ï¼Œå æœ‰æ¬²å¼ºï¼Œäººè®¾ç‰¹æ€§ç›´ç‡ã€‚</li>
                    <li><strong>å¤œç¾Šï¼š</strong> é¦™é¦™è½¯è½¯çš„ç”·å¨˜äººè®¾ï¼Œæ¸©æŸ”ä½“è´´ã€‚</li>
                </ul>
            </div>
        </details>

        <!-- æ›´æ–°æ—¥å¿— -->
        <details class="accordion">
            <summary class="accordion-trigger"><span>ğŸ“‹ æ›´æ–°æ—¥å¿—</span></summary>
            <div class="accordion-content">
                <h3>é¡¹ç›®å‘å±•å†ç¨‹</h3>
                <ul>
                    <li><strong>v1.0 (é¦–ç‰ˆå‘å¸ƒ)ï¼š</strong> å®ŒæˆåŸºç¡€ä¸–ç•Œè§‚ä¸è§’è‰²è®¾å®š</li>
                    <li><strong>è®¡åˆ’ä¸­ï¼š</strong> è¡¥å……æ›´å¤šåŠ¨æ¼«å‰§æƒ…è¦ç´ ä¸é…è§’çº¿</li>
                </ul>
            </div>
        </details>

        <!-- é¸£è°¢å¡ç‰‡ -->
        <div class="credits-card">
            <div class="credits-content">
                <h2>ğŸ™ é¸£è°¢åå•</h2>
                <div class="credit-item">Single</div>
                <div class="credit-item">Leo335346</div>
                <div class="credit-item">çŒ«çŒ«</div>
                <div class="credit-item">å¤œç¾Š</div>
                <div class="credit-item">æ‰€æœ‰æ¸¸ç©æœ¬å¡çš„æœ‹å‹ä»¬</div>
            </div>
        </div>
    </main>

    <!-- ğŸµ æ‚¬æµ®æ’­æ”¾å™¨ -->
    <div class="music-widget expanded" id="musicWidget">
        <button class="minimize-btn" id="minimizeBtn" title="æœ€å°åŒ–">âˆ’</button>
        <div class="player-header">
            <div class="music-disc" id="disc">â™ª</div>
            <div class="player-content">
                <div class="song-title" id="songTitle">Connecting...</div>
                <div class="controls-row">
                    <button class="ctrl-btn" id="modeBtn" title="åˆ‡æ¢æ¨¡å¼">ğŸ”</button>
                    <button class="ctrl-btn" id="prevBtn">â®</button>
                    <button class="ctrl-btn" id="playPauseBtn" style="font-size: 1.4rem;">â–¶</button>
                    <button class="ctrl-btn" id="nextBtn">â­</button>
                    <button class="ctrl-btn" id="listBtn" title="æ­Œå•">ğŸ“œ</button>
                </div>
            </div>
        </div>
        <div class="playlist-panel" id="playlistPanel"></div>
        <audio id="bgmAudio" preload="none"></audio>
    </div>

    <script>
        /* ==================== UI äº¤äº’ç®¡ç†å™¨ ==================== */
        class UIManager {
            constructor() {
                this.targetUrl = "https://discord.com/channels/1134557553011998840/1434325852165902366";
                this.creditClickCounts = {};
                this.burstCooldown = 0;
                this.init();
            }

            init() {
                this.bindMainCopyButton();
                this.initHearts();
                this.setupCreditEggs();
                this.setupAccessibility();
            }

            bindMainCopyButton() {
                const mainBtn = document.getElementById('mainCopyBtn');
                if (mainBtn) {
                    mainBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.copyTextToClipboard(this.targetUrl, mainBtn);
                    });
                }
            }

            copyTextToClipboard(text, btnElement) {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text)
                        .then(() => this.handleCopySuccess(btnElement))
                        .catch(() => this.fallbackCopy(text, btnElement));
                } else {
                    this.fallbackCopy(text, btnElement);
                }
            }

            fallbackCopy(text, btnElement) {
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    if (successful) {
                        this.handleCopySuccess(btnElement);
                    } else {
                        this.showToast('âŒ å¤åˆ¶å¤±è´¥');
                    }
                } catch (err) {
                    this.showToast('âŒ å¤åˆ¶å¤±è´¥');
                }
            }

            handleCopySuccess(btn) {
                this.showToast('âœ… é“¾æ¥å·²å¤åˆ¶');
                if (btn) {
                    const span = btn.querySelector('span');
                    if (span) {
                        const originalText = span.textContent;
                        span.textContent = 'å·²å¤åˆ¶ï¼';
                        btn.style.background = 'linear-gradient(120deg, var(--color-green), #5cffac)';
                        setTimeout(() => {
                            btn.style.background = '';
                            span.textContent = originalText;
                        }, 2000);
                    }
                }
            }

            initHearts() {
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.music-widget') || e.target.closest('button') || e.target.closest('.credit-item')) return;
                    this.createHeart(e.clientX, e.clientY);
                });
            }
            
            createHeart(x, y) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = ['ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’•'][Math.floor(Math.random() * 4)];
                heart.style.left = (x - 10) + 'px';
                heart.style.top = (y - 10) + 'px';
                document.body.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            }

            setupCreditEggs() {
                const items = document.querySelectorAll('.credit-item');
                items.forEach(item => {
                    const name = item.textContent.trim();
                    this.creditClickCounts[name] = 0;
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.creditClickCounts[name]++;
                        if (this.creditClickCounts[name] >= 6) {
                            if (this.burstCooldown === 0) {
                                this.createBurst(e);
                                this.creditClickCounts[name] = 0;
                                this.burstCooldown = 15;
                                const timer = setInterval(() => {
                                    this.burstCooldown--;
                                    if (this.burstCooldown <= 0) clearInterval(timer);
                                }, 1000);
                            }
                        } else if (this.creditClickCounts[name] > 3) {
                            this.showBubble(e);
                        } else {
                            this.createHeart(e.clientX, e.clientY);
                        }
                    });
                });
            }

            showBubble(e) {
                const bubble = document.createElement('div');
                bubble.className = 'floating-bubble';
                bubble.textContent = 'Ë¶áµ’áœŠË‚Ë¶\nåˆ«æˆ³äº†å•¦';
                const rect = e.target.getBoundingClientRect();
                bubble.style.left = (rect.left + rect.width / 2) + 'px';
                bubble.style.top = rect.top + 'px';
                document.body.appendChild(bubble);
                setTimeout(() => bubble.remove(), 2000);
            }

            createBurst(e) {
                for(let i=0; i<8; i++) {
                    setTimeout(() => {
                         const bubble = document.createElement('div');
                         bubble.className = 'floating-bubble';
                         bubble.textContent = 'ğŸ’¢';
                         const rect = e.target.getBoundingClientRect();
                         const offsetX = (Math.random() - 0.5) * 100;
                         bubble.style.left = (rect.left + rect.width/2 + offsetX) + 'px';
                         bubble.style.top = rect.top + 'px';
                         document.body.appendChild(bubble);
                         setTimeout(() => bubble.remove(), 2000);
                    }, i * 100);
                }
            }

            showToast(msg) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = msg;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 300);
                }, 2000);
            }

            setupAccessibility() {
                document.querySelectorAll('.accordion').forEach(acc => {
                    acc.addEventListener('keydown', (e) => {
                        if(e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault(); acc.open = !acc.open;
                        }
                    });
                });
            }
        }

        /* ==================== ğŸµ éŸ³ä¹æ’­æ”¾å™¨ç®¡ç†å™¨ (çƒ­æ›´æ–°ç‰ˆ) ==================== */
        class MusicManager {
            constructor() {
                // GitHub Pages åŸºç¡€åœ°å€
                this.baseUrl = "https://stockielchan.github.io/stocking-music/";
                // JSON æ–‡ä»¶å
                this.jsonUrl = this.baseUrl + "music.json?t=" + new Date().getTime(); // åŠ æ—¶é—´æˆ³é˜²ç¼“å­˜

                this.widget = document.getElementById('musicWidget');
                this.audio = document.getElementById('bgmAudio');
                this.disc = document.getElementById('disc');
                this.titleEl = document.getElementById('songTitle');
                this.playlistPanel = document.getElementById('playlistPanel');
                
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.prevBtn = document.getElementById('prevBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.modeBtn = document.getElementById('modeBtn');
                this.listBtn = document.getElementById('listBtn');
                this.minimizeBtn = document.getElementById('minimizeBtn');

                this.playlist = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.isExpanded = true;
                this.playMode = 0; 
                this.modes = [
                    { icon: 'ğŸ”', name: 'é¡ºåºæ’­æ”¾' },
                    { icon: 'ğŸ”‚', name: 'å•æ›²å¾ªç¯' },
                    { icon: 'ğŸ”€', name: 'éšæœºæ’­æ”¾' }
                ];

                this.init();
            }

            async init() {
                this.setupPosition();
                this.setupDraggable();
                this.bindEvents();
                await this.fetchMusicList();
            }

            /* 1. ä» GitHub è¯»å– JSON */
            async fetchMusicList() {
                try {
                    const response = await fetch(this.jsonUrl);
                    if (!response.ok) throw new Error("Config not found");
                    const data = await response.json();
                    
                    // æ„å»ºæ’­æ”¾åˆ—è¡¨
                    this.playlist = data.map(item => ({
                        title: item.title,
                        url: this.baseUrl + encodeURIComponent(item.file)
                    }));

                    if (this.playlist.length > 0) {
                        this.renderPlaylist();
                        this.loadSong(0, false);
                        this.titleEl.textContent = `å°±ç»ª: ${this.playlist[0].title}`;
                    } else {
                        this.titleEl.textContent = "æ­Œå•ä¸ºç©º";
                    }
                } catch (error) {
                    console.error(error);
                    this.titleEl.textContent = "ç¦»çº¿æ¨¡å¼ / åŠ è½½å¤±è´¥";
                }
            }

            setupPosition() {
                if (window.innerWidth <= 768) {
                    this.widget.style.top = '20px';
                    this.widget.style.bottom = 'auto';
                    this.widget.style.left = '50%';
                    this.widget.style.transform = 'translateX(-50%)';
                }
            }

            setupDraggable() {
                let isDragging = false, startX, startY, initialLeft, initialTop;
                const startDrag = (e) => {
                    if (e.target.closest('button') || e.target.closest('.playlist-panel')) return;
                    isDragging = true;
                    this.widget.style.transition = 'none';
                    const touch = e.touches ? e.touches[0] : e;
                    startX = touch.clientX; startY = touch.clientY;
                    const rect = this.widget.getBoundingClientRect();
                    initialLeft = rect.left; initialTop = rect.top;
                    this.widget.style.transform = 'none';
                    this.widget.style.bottom = 'auto'; this.widget.style.right = 'auto';
                    this.widget.style.left = initialLeft + 'px'; this.widget.style.top = initialTop + 'px';
                };
                const onDrag = (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                    const touch = e.touches ? e.touches[0] : e;
                    const dx = touch.clientX - startX; const dy = touch.clientY - startY;
                    this.widget.style.left = `${initialLeft + dx}px`;
                    this.widget.style.top = `${initialTop + dy}px`;
                };
                const stopDrag = () => { isDragging = false; this.widget.style.transition = ''; };
                this.widget.addEventListener('mousedown', startDrag);
                this.widget.addEventListener('touchstart', startDrag, {passive:false});
                document.addEventListener('mousemove', onDrag);
                document.addEventListener('touchmove', onDrag, {passive:false});
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
            }

            loadSong(index, autoPlay = true) {
                if (!this.playlist[index]) return;
                this.currentIndex = index;
                const song = this.playlist[index];
                this.audio.src = song.url;
                this.titleEl.textContent = song.title;
                const items = this.playlistPanel.querySelectorAll('.playlist-item');
                items.forEach(el => el.classList.remove('current'));
                if (items[index]) items[index].classList.add('current');
                if (autoPlay) {
                    this.audio.play().catch(() => {});
                    this.isPlaying = true;
                    this.updatePlayUI();
                }
            }

            togglePlay() {
                if (this.audio.paused) { this.audio.play(); this.isPlaying = true; }
                else { this.audio.pause(); this.isPlaying = false; }
                this.updatePlayUI();
            }

            updatePlayUI() {
                this.playPauseBtn.textContent = this.isPlaying ? 'â¸' : 'â–¶';
                if (this.isPlaying) { this.disc.classList.add('rotate'); this.disc.classList.remove('paused'); }
                else { this.disc.classList.add('paused'); }
            }

            nextSong(isAuto = false) {
                if (isAuto && this.playMode === 1) { this.audio.currentTime = 0; this.audio.play(); return; }
                if (this.playMode === 2) {
                    let nextIndex;
                    do { nextIndex = Math.floor(Math.random() * this.playlist.length); }
                    while (this.playlist.length > 1 && nextIndex === this.currentIndex);
                    this.loadSong(nextIndex);
                } else {
                    let nextIndex = (this.currentIndex + 1) % this.playlist.length;
                    this.loadSong(nextIndex);
                }
            }

            prevSong() {
                let prevIndex = (this.currentIndex - 1 + this.playlist.length) % this.playlist.length;
                this.loadSong(prevIndex);
            }

            toggleMode() {
                this.playMode = (this.playMode + 1) % 3;
                const mode = this.modes[this.playMode];
                this.modeBtn.textContent = mode.icon;
                this.titleEl.textContent = `æ¨¡å¼: ${mode.name}`;
                setTimeout(() => {
                    if(this.titleEl.textContent.includes('æ¨¡å¼:')) 
                        this.titleEl.textContent = this.playlist[this.currentIndex]?.title || "Ready";
                }, 1500);
            }

            toggleList() { this.playlistPanel.classList.toggle('show'); }

            toggleMinimize() {
                this.isExpanded = !this.isExpanded;
                if (this.isExpanded) {
                    this.widget.classList.remove('collapsed');
                    this.widget.classList.add('expanded');
                    this.minimizeBtn.style.display = 'block';
                } else {
                    this.widget.classList.remove('expanded');
                    this.widget.classList.add('collapsed');
                    this.minimizeBtn.style.display = 'none';
                    this.playlistPanel.classList.remove('show');
                }
            }

            renderPlaylist() {
                this.playlistPanel.innerHTML = '';
                this.playlist.forEach((song, i) => {
                    const item = document.createElement('div');
                    item.className = 'playlist-item';
                    item.textContent = `${i + 1}. ${song.title}`;
                    item.onclick = () => this.loadSong(i, true);
                    this.playlistPanel.appendChild(item);
                });
            }

            bindEvents() {
                this.playPauseBtn.onclick = () => this.togglePlay();
                this.nextBtn.onclick = () => this.nextSong();
                this.prevBtn.onclick = () => this.prevSong();
                this.modeBtn.onclick = () => this.toggleMode();
                this.listBtn.onclick = () => this.toggleList();
                this.minimizeBtn.onclick = (e) => { e.stopPropagation(); this.toggleMinimize(); };
                this.widget.onclick = (e) => {
                    if (!this.isExpanded && !e.target.closest('.minimize-btn')) this.toggleMinimize();
                };
                this.audio.onended = () => this.nextSong(true);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new UIManager();
            new MusicManager();
        });
    </script>
</body>
</html>
